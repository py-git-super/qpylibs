###  HLW8110

**类引用：**

```python
from usr.hlw8110_module import Hlw8110_uart
```

 **实例化参数：**

| 名称   | 必填 | 类型 | 说明                                                         |
| ------ | ---- | ---- | ------------------------------------------------------------ |
| uart_n | 是   | int  | UARTn作用如下：<br/>UART0 - DEBUG PORT<br/>UART1 – BT PORT<br/>UART2 – MAIN PORT<br/>UART3 – USB CDC PORT |

```python
hlw8110 = Hlw8110_uart(uart_n=UART.UART2)
```

 **接口函数**

l **reset()**

​	复位

参数：

​    无。

返回值：

​	无。 

l **read_i()**

​	读电流有效值寄存器和电流有效值转换系数，具体电流跟接入电路的电阻有关，本接口不做计算。

 参数：

​    无。

返回值：

​	正常测量：(电流有效值寄存器值,电流有效值转换系数)
​    无有效数据：(0,0)

l **read_u()**

​	读电压有效值寄存器和电压有效值转换系数，本接口不做计算。

 参数：

​    无。

返回值：

​	正常测量：(电压有效值寄存器值,电压有效值转换系数)
​    无有效数据：(0,0)

l **read_power()**

​	读有功功率寄存器和有功功率转换系数，本接口不做计算。

 参数：

​    无。

返回值：

​	正常测量：(有功功率寄存器值,有功功率转换系数)
​    无有效数据：(0,0)

l **read_angle()**

​	配置EMUCON2寄存器，然后读相角。

 参数：

​    无。

返回值：

​	读取成功：相角
​    失败：-1

l **zx_en(zx_type)**

​	过零检测使能。

 参数：

| 名称    | 必填 | 类型 | 说明                                                         |
| ------- | ---- | ---- | ------------------------------------------------------------ |
| zx_type | 是   | int  | 过零输出方式<br />0：表示选择正向过零点作为过零检测信号，过零输出信号为信号频率/2                 <br />1：表示选择负向过零点作为过零检测信号，过零输出信号为信号频率/2                 <br />2,3：表示选择正向和负向过零点均作为过零检测信号，过零输出信号为信号频率 |

返回值：

​	成功：0
​    失败：-1

l **int_en(int_type)**

​	中断使能。

​	注：int_type 范围0-15，不为5, 且0,6,12,13,14,15bit默认开启，不受软件控制

 参数：

| 名称    | 必填 | 类型 | 说明                                                         |
| ------- | ---- | ---- | ------------------------------------------------------------ |
| zx_type | 是   | int  | 中断类型<br />0：均值数据更新中断使能<br />1：PFA 中断使能<br />3：通道A有功电能寄存器溢出中断使能<br />6：瞬时中断使能<br />7：电流 A 过流中断使能<br />9：电压过压中断使能<br />10：功率过载的中断使能 <br />11：电压欠压中断使能<br />13：电流 A过零中断使能<br />14：电压过零中断使能<br />15：漏电中断使能 |

返回值：

​	成功：0
​    失败：-1

l **int_clear(int_type)**

​	清除中断使能。

​	注：int_type 范围0-15，不为5, 且0,6,12,13,14,15bit默认开启，不受软件控制

 参数：

| 名称    | 必填 | 类型 | 说明                                                         |
| ------- | ---- | ---- | ------------------------------------------------------------ |
| zx_type | 是   | int  | 中断类型<br />0：均值数据更新中断使能<br />1：PFA 中断使能<br />3：通道A有功电能寄存器溢出中断使能<br />6：瞬时中断使能<br />7：电流 A 过流中断使能<br />9：电压过压中断使能<br />10：功率过载的中断使能 <br />11：电压欠压中断使能<br />13：电流 A过零中断使能<br />14：电压过零中断使能<br />15：漏电中断使能 |

返回值：

​	成功：0
​    失败：-1

l **process_int()**

​	中断检测。

​	注：检测特定中断，请判断返回值的对应位是否为1。

 参数：

​	无

返回值：

|  名称   | 类型 |                             说明                             |
| :-----: | :--: | :----------------------------------------------------------: |
| in_flag | int  | 读取中断状态寄存器（0x41）成功：16位寄存器值<br />读取中断状态寄存器（0x41）失败：0 |

**demo：**

```python
hlw8110 = Hlw8110_uart(uart_n=UART.UART2)
# hlw8110.zx_en(zx_type=3)
# hlw8110.int_en(int_type=0)
hlw8110.int_en(int_type=11)     #电压欠压中断使能
# hlw8110.int_clear(int_type=0)
# hlw8110.int_clear(int_type=11)
    for i in range(2):
        print("start reading...")
        curr,ic = hlw8110.read_i()
        volt,uc = hlw8110.read_u()
        power,pc = hlw8110.read_power()
        angle = hlw8110.read_angle()
        print("reading complete.")
        #根据外部电路计算电流，电压，有功功率
        if curr:
            print("电流寄存器值：{0}, 电流有效值转换系数：{1}".format(curr, ic))
        if volt:
            print("电压寄存器值：{0}, 电压有效值转换系数：{1}".format(volt, uc))
        if power:
            print("有功功率寄存器值：{0}, 有功功率转换系数：{1}".format(power,pc))
        if angle != -1:
            print("相角：{}".format(angle))
        utime.sleep(1)
        while True:
            flag = hlw8110.process_int() #注意，0,6,12,13,14,15位无论使能与否，都会产生中断
            if (flag & 0x0800):
                print('电压欠压中断 just happened')
                break
            utime.sleep_ms(100) 
```

